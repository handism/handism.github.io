---
title: AWSで非機能要件を実現するには
date: 2024-05-21
tags: [AWS, Infrastructure]
image: many-clouds.webp
---


## 経緯

AWSでシステムを構築するにあたり、毎回1からアーキテクチャを考えるのは大変なので、個人的なテンプレートを作っておいてどんどん楽していきたい。

ここでは、各種非機能要件ごとにAWSでどう構築すべきかを考えていく。

## コスト削減

### コストのチェック
* AWS Budgets
* AWS Cost Explorer

まずはここら辺のサービスを見てコストをチェックしていく。

Billing Alertを設定しておくのもあり。

### インスタンスタイプの見直し

利用しているインスタンスが過剰スペックになっていないか確認。適切なサイズのインスタンスにスケールダウンすることでコストを削減できる。スポットインスタンスを利用することで、コストを大幅に削減することも可能。

開発環境だけRDSやECSのスペックを落とすってのもあり。


### リザーブドインスタンスやSavings Plansの活用

リザーブドインスタンス（RI）やSavings Plansを利用することで、1年や3年の契約を前提に大幅な割引を受けることができる。


### 未使用のリソースの整理

使用していないインスタンス、EBSボリューム、Elastic IPアドレス、スナップショットなどが残っていないか確認し、不要なものは削除。

また、開発環境は1AZ構成にするなども有効だし、使用しない夜間はEC2やRDSは停止しておくのもかなり有効な手段。


### ストレージの最適化

S3のストレージクラスを見直し、アクセス頻度に応じて適切なクラスにデータを移動することでコストを削減できる。

データのライフサイクルポリシーを設定し、古いデータを自動的に削除またはアーカイブすることも検討。


## DR（災害対策）

AWSでは大きく分けて4つのDR戦略が示されている。以下に比較表を記載しておくので、要件に応じて選択する。

| 戦略                          | 復旧時点目標 (RPO)      | 復旧時間目標 (RTO)        | 特徴                                                                                      | コスト      |
|-------------------------------|------------------------|------------------------|-----------------------------------------------------------------------------------------|-----------|
| **バックアップとリストア**     | 数時間                 | 24時間未満              | コスト効果が高く、データを他のリージョンにバックアップ。災害時にはリソースをプロビジョニングし、データをリストアする。 | 低         |
| **パイロットライト**          | 数十秒～数分           | 数十秒～数分           | 最小限の環境を常に稼働させ、重要なデータをDRリージョンに継続的にレプリケーション。                                     | 中程度     |
| **ウォームスタンバイ**        | 数分                   | 数分                   | フル機能の環境を縮小した形でDRリージョンに常に稼働させ、災害時には迅速にスケールアップ可能。                              | 高         |
| **マルチサイトアクティブ/アクティブ** | ほぼゼロ               | ゼロまたはほぼゼロ     | フルスケールの環境を複数のリージョンで同時に稼働させ、シームレスなフェイルオーバーとゼロダウンタイムを実現。               | 非常に高い |



## ログ管理

AWSのログの種類は多岐にわたる。以下に主要なログの種類をまとめた。

| ログの種類            | 説明                                                         | 主な用途                                                       |
|----------------------|------------------------------------------------------------|-------------------------------------------------------------|
| CloudTrail Logs      | AWSアカウントのAPIコールの履歴を記録。誰が何をしたかを追跡可能。  | セキュリティ監査、コンプライアンス、トラブルシューティング。       |
| CloudWatch Logs      | AWSリソースやオンプレミスサーバーから収集されたログデータ。         | 運用監視、トラブルシューティング、パフォーマンス分析。          |
| VPC Flow Logs        | VPC内のネットワークトラフィックの情報を記録。                    | ネットワークモニタリング、セキュリティ分析、トラブルシューティング。 |
| ELB Access Logs      | Elastic Load Balancerのアクセスログ。                          | トラフィック分析、セキュリティ監査、アクセスパターンの理解。        |
| S3 Access Logs       | S3バケットへのアクセス記録。                                    | セキュリティ監査、アクセスパターン分析、コンプライアンス。          |
| RDS Logs             | Amazon RDSインスタンスのデータベースログ。                       | データベースの監視、パフォーマンスチューニング、トラブルシューティング。 |
| Lambda Logs          | AWS Lambda関数の実行ログ。                                      | 関数のデバッグ、パフォーマンス分析、エラーハンドリング。          |
| CloudFront Logs      | Amazon CloudFrontの配信ログ。                                  | トラフィック分析、コンテンツ配信の最適化、セキュリティ監査。        |
| Config Logs          | AWS Configによるリソースの構成変更履歴。                          | リソース変更の追跡、コンプライアンス監査、セキュリティ分析。        |
| GuardDuty Logs       | AWS GuardDutyによる脅威検出ログ。                                 | セキュリティ監視、脅威検出と対応、コンプライアンス。              |
| CloudFormation Logs  | AWS CloudFormationスタックの操作ログ。                           | スタックデプロイの監視、トラブルシューティング、変更管理。         |
| ECS Logs             | Amazon ECSタスクの実行ログ。                                     | コンテナのデバッグ、パフォーマンス監視、トラブルシューティング。    |
| EKS Logs             | Amazon EKSクラスターのログ。                                     | クラスターの監視、トラブルシューティング、パフォーマンス分析。     |
| Route 53 Logs        | Amazon Route 53のクエリログ。                                    | DNSクエリ分析、トラフィックパターンの理解、セキュリティ監査。      |
| Kinesis Data Firehose Logs | Kinesis Data Firehoseのデリバリストリームログ。               | データストリーミングの監視、トラブルシューティング、パフォーマンス分析。 |



## AWSアカウント準備

* アカウント作成
* AWS Control Tower
  * ランディングゾーンの設定
* AWS CloudTrailの有効化
* IAMユーザーの作成
* AWS Organization


## セキュリティ管理

* AWS Security Hubの有効化
* Amazon GuardDutyの有効化

* AWS Trusted Advisor

* Amazon CloudWatch
* AWS Systems Manager
* AWS Step Functions

* AWS WAF

* Amazon EventBridge